"0",""
"0","k.bls_prodi <- "
"0",""
"0","# prodi entries"
"0","  keto.samples %>% "
"0","  mutate(item = str_to_lower(item)) %>% "
"0","  rename_at(.vars = vars(`Energie (kcal)`:`Vitamin K Phyllochinon`), "
"0","            .funs = funs(paste0(., '.prodi'))) %>% "
"0","  "
"0","  # bls map"
"0","  left_join(., bls.extended %>% "
"0","              mutate(Energie_orig = `Energie, Gesamt (kcal)`) %>% "
"0","              rename_at(.vars = vars(`Eiweiß, Proteingehalt`:`Energie, Gesamt (kcal)`), "
"0","                        .funs = funs(paste0(., '.bls'))),  "
"0","            by = c('item' = 'item_prodi')) %>% "
"0","  "
"0","  # normalize to kcal"
"0","  mutate_at(.vars = vars(ends_with('.bls')), "
"0","            .funs = funs(replace_na(. / Energie_orig, 0) * `Energie (kcal).prodi`)) %>% "
"0","  "
"0","  # split by nutrient db"
"0","  rownames_to_column('diet_id') %>% "
"0","  pivot_longer(names_to = 'nutrient', values_to = 'value', cols = c(ends_with('.prodi'), ends_with('.bls'))) %>% "
"0","  mutate(value = replace_na(value, 0)) %>%"
"0","  separate(nutrient, into = c('nutrient', 'database'), sep = '[.]') %>% "
"0","  # select(-Energie_orig) %>%"
"0","  "
"0","  # generate id for item and db"
"0","  mutate(diet_item_id = paste0(database, '.', diet_id)) %>% "
"0",""
"0","  # spread back by nutrient"
"0","  pivot_wider(names_from = 'nutrient', values_from = 'value') %>% "
"0","  "
"0","  # fix energy"
"0","  mutate(`Energie (kcal)` = ifelse(is.infinite(`Energie (kcal)`), "
"0","                                   `Energie, Gesamt (kcal)`, "
"0","                                   `Energie (kcal)`)) %>% "
"0","  "
"0","# k.bls <- k.bls_prodi %>% filter(database == 'bls')"
"0","# write_tsv(k.bls, path = 'C:/Users/Juliane/Desktop/project.directory/data/tables/ k.bls_08.10.tsv',append = FALSE)"
"0",""
"0","# write_tsv(k.bls_prodi, path = 'C:/Users/Juliane/Desktop/project.directory/data/tables/ k.bls_prodi_13_08.tsv',append = FALSE)"
"0",""
"0","  # select nutrients available in both"
"0","  select(diet_item_id, file_name:database, "
"0","         `Eiweiß, Proteingehalt`,`Kohlenhydrate`,`Fett`,"
"0","         `Ballaststoffe`,"
"0","         # `Vitamin B9 gesamte Folsäure`,`Vitamin B7 Biotin (Vitamin H)`,"
"0","         ## `Vitamin B12 Cobalamin`,"
"0","         # `Vitamin K Phyllochinon`,`Vitamin B3 Niacinäquivalent`,`Vitamin A Retinoläquivalent`,`Eisen`,"
"0","         # `Vitamin B6 Pyridoxin`,"
"0","         `Gesättigte Fettsäuren`,"
"0","         # `Vitamin E Tocopherol`,`Vitamin B5 Pantothensäure`,`Vitamin E Tocopherol`,"
"0","         ## `EPA - Eicosapentaensäure`, `Calcium`,`DHA - Docosahexaensäure`,"
"0","         # `Iodid`,`Vitamin B2 Riboflavin`,"
"0","         # `Cholesterin`,`Vitamin C Ascorbinsäure`,"
"0","         `Einfach ungesättigte Fettsäuren`,"
"0","         # `Octadecatriensäure/Linolensäure`,"
"0","         ## `Octadecadiensäure/Linolsäure`, "
"0","         # `Vitamin B1 Thiamin`,"
"0","         ## `Vitamin D Calciferole`,"
"0","         `Alkohol (Ethanol)`,"
"0","         `Energie (kcal)`"
"0","         )"
"0",""
"0","names(k.bls_prodi)[names(k.bls_prodi) == 'Energie_orig'] <- 'Energie_bls'"
"0","  "
"0","k.bls <- k.bls_prodi %>% filter(database == 'bls')"
"0","k.prodi <- k.bls_prodi %>% filter(database == 'prodi')"
"0",""
