"0","# testfile = '../data/EP_Microbiome/05AP.U1.xls'"
"0",""
"0","read_keto_file <- function(file) {"
"0","  df <- readxl::read_xls(file)"
"0","  file_name <- gsub(basename(file), pattern = '.xls', replacement = '')"
"0","  sample_name_col <- names(df)[1]"
"0","  sample_name <- str_split_fixed(sample_name_col, pattern = ' ', n = 2)[,1]"
"0","  df[,'sample'] <- sample_name"
"0","  df[,'file_name'] <- file_name"
"0","  "
"0","  date_vec = c()"
"0","  date_idx = c()"
"0",""
"0","  for (e in pull(df[,1])) {"
"0","    if (grepl(e, pattern = '^[[:digit:]]')) {"
"0","      current_date = e"
"0","      date_idx = c(date_idx, T)"
"0","    } else {"
"0","      date_idx = c(date_idx, F)"
"0","    }"
"0","    date_vec = c(date_vec, current_date)"
"0","  }"
"0","  "
"0","  df[, 'is_date'] <- date_idx"
"0","  df[, 'date'] <- janitor::excel_numeric_to_date(as.numeric(date_vec), include_time = F)"
"0","  df <- df %>% "
"0","    rename(item = all_of(sample_name_col)) %>% "
"0","    rename_all(.funs = funs(gsub(., pattern = '¹', replacement = ''))) %>% "
"0","    filter(!grepl(item, pattern = 'Gesamt')) %>% "
"0","    separate(sample, into = c('sample','time_point.label'), sep = '_') %>% "
"0","    mutate(time_point = paste0('0', str_to_upper(str_split_fixed(file_name, pattern = '[._]', 2)[,2])), "
"0","           day = dense_rank(date)) %>% "
"0","    rename("
"0","      'Energie (kcal)' = 'kcal',"
"0","      'Eiweiß, Proteingehalt' = 'EW (g)',"
"0","      'Fett' = 'F (g)',"
"0","      'Kohlenhydrate' = 'KH (g)',"
"0","      'Ballaststoffe' = 'Bst (g)',"
"0","      'Cholesterin' = 'Chol (mg)',"
"0","      'Einfach ungesättigte Fettsäuren' = 'EUFS (g)',"
"0","      'Gesättigte Fettsäuren' = 'GFS (g)',"
"0","      'Alkohol (Ethanol)' = 'Alk (g)',"
"0","      'Vitamin B7 Biotin (Vitamin H)' = 'Biot (µg)',"
"0","      'EPA - Eicosapentaensäure' = 'C205 (g)',"
"0","      'DHA - Docosahexaensäure' = 'C226 (g)',"
"0","      'Calcium' = 'Ca (mg)',"
"0","      'Eisen' = 'Fe (mg)',"
"0","      'Vitamin B9 gesamte Folsäure' = 'Fols (µg)',"
"0","      'Iodid' = 'J (µg)',"
"0","      'Kalium' = 'K (mg)',"
"0","      'Octadecadiensäure/Linolsäure' = 'LieS (g)',"
"0","      'Octadecatriensäure/Linolensäure' = 'LinS (g)',"
"0","      'Magnesium' = 'Mg (mg)',"
"0","      'Mehrfach ungesättigte Fettsäuren' = 'MUFS (g)',"
"0","      'Vitamin B3 Niacinäquivalent' = 'NiaÄ (µg)',"
"0","      'Vitamin B5 Pantothensäure' = 'Pta (mg)',"
"0","      'Phosphor' = 'P (mg)',"
"0","      'Vitamin A Retinoläquivalent' = 'ReEq (µg)',"
"0","      'Vitamin B1 Thiamin' = 'B1 (mg)',"
"0","      'Vitamin B2 Riboflavin' = 'B2 (mg)',"
"0","      'Vitamin B12 Cobalamin' = 'B12 (µg)',"
"0","      'Vitamin B6 Pyridoxin' = 'B6 (mg)',"
"0","      'Vitamin C Ascorbinsäure' = 'C (mg)',"
"0","      'Vitamin D Calciferole' = 'D (µg)',"
"0","      'Vitamin E Tocopherol' = 'E (mg)',"
"0","      'Vitamin K Phyllochinon' = 'K (µg)')"
"0","  "
"0","  df.summary <- df %>% filter(is_date) %>% dplyr::select(file_name, sample, time_point.label, time_point, day,"
"0","                                                  date, everything(), -is_date, -item)"
"0","  df.sample <- df %>% filter(!is_date) %>% dplyr::select(file_name, sample, time_point.label, time_point, day,date, everything(), -is_date)"
"0","  "
"0","  out <- list('df.summary' = df.summary,"
"0","          'df.sample' = df.sample)"
"0","  return(out)"
"0","}"
